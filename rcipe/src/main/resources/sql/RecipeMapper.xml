<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BoardMapper">

	<resultMap type="com.model2.mvc.service.domain.Board" id="boardSelectMap">
		<result property="boardNo" column="board_no" jdbcType="INTEGER" />
		<result property="writer.userId" column="user_id" jdbcType="VARCHAR" />
		<result property="boardTitle" column="board_title" jdbcType="VARCHAR" />
		<result property="boardContent" column="board_content"
			jdbcType="VARCHAR" />
	</resultMap>

	<insert id="insertBoard" parameterType="com.model2.mvc.service.domain.Board">
		INSERT
		INTO
		Board(board_no, user_id, board_title, board_content)
		VALUES(seq_board_board_no.NEXTVAL, #{writer.userId}, #{boardTitle},
		#{boardContent})
	</insert>

	<select id="getBoard" parameterType="int" resultMap="boardSelectMap">
		SELECT
		user_id, board_title, board_content, board_no
		FROM board
		WHERE board_no = #{value}
	</select>

	<update id="updateBoard" parameterType="com.model2.mvc.service.domain.Board">
		UPDATE board
		<set>
			board_title = #{boardTitle},
			board_content = #{boardContent},
		</set>
		WHERE board_no = #{boardNo}
	</update>

	<delete id="removeBoard" parameterType="int">
		DELETE
		FROM board
		WHERE
		board_no = #{value}
	</delete>

	<select id="getUserList1" parameterType="com.model2.mvc.common.Search"
		resultMap="boardSelectMap">
		<include refid="sql" />
	</select>

	<select id="getTotalCount" parameterType="com.model2.mvc.common.Search"
		resultType="int">
		SELECT COUNT(*) FROM
		(<include refid="sql" />)
		countTable
	</select>

	<select id="getBoardList" parameterType="com.model2.mvc.common.Search"
		resultMap="boardSelectMap">
		SELECT * FROM ( SELECT inner_table.* , ROWNUM AS row_seq FROM (
		<include refid="sql" />
		) inner_table WHERE ROWNUM <![CDATA[<]]>=#{currentPage}*#{pageSize}
		)
		WHERE row_seq BETWEEN (#{currentPage}-1)*#{pageSize}+1 AND
		#{currentPage}*#{pageSize}

	</select>

	<sql id="sql">
		SELECT
		board_no, user_id, board_title, board_content
		FROM board
		<where>
			<choose>
				<when test="searchCondition != null">
					<if test="searchCondition == 0 and searchKeyword !='' ">
						user_id IN
						#{searchKeyword}
					</if>
					<if test="searchCondition == 1 and searchKeyword !='' ">
						user_name IN
						#{searchKeyword}
					</if>
				</when>
			</choose>
		</where>
		ORDER BY board_no DESC
	</sql>

</mapper>